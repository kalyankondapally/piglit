# Test initialization of an array of structures where the elements of
# the structure do not all have the same vector size.
#
# This test reproduces the problem described in
# https://bugs.freedesktop.org/show_bug.cgi?id=40865#c9.

[require]
GLSL ES >= 1.00
GL ES >= 2.0

[vertex shader]
attribute vec4 vertex;
varying vec4 color;
struct s { float f; vec3 v; };
uniform s a[1];

void main(void)
{
    float x = 3.0;
    if (a[0].f==3.0)
      color = vec4(0.0, 1.0, 0.0, 1.0); // green
    else
      color = vec4(1.0, 0.0, 0.0, 1.0); // red
    gl_Position = vertex;
}

[fragment shader]
precision highp float;
varying vec4 color;
void main(void)
{
    gl_FragColor = color;
}

[test]
uniform float a[0].f 3.0
uniform vec3 a[0].v vec3(3.0)
draw rect -1 -1 2 2
probe all rgb 0.0 1.0 0.0 1.0
